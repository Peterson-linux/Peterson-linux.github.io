<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Pacemaker+Corosync+MFS | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Red Hat Enterprise Linux 6.5Pacemaker+MFS解决master的单点故障实验环境1Environment : selinux and iptables disabled&amp;#10;iscsi server : server33.example.com : 172.25.0.33&amp;#10;Master1+Pacemaker : server28.example.co">
<meta property="og:type" content="article">
<meta property="og:title" content="Pacemaker+Corosync+MFS">
<meta property="og:url" content="http://yoursite.com/2016/03/10/Pacemaker-MFS/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="Red Hat Enterprise Linux 6.5Pacemaker+MFS解决master的单点故障实验环境1Environment : selinux and iptables disabled&amp;#10;iscsi server : server33.example.com : 172.25.0.33&amp;#10;Master1+Pacemaker : server28.example.co">
<meta property="og:image" content="http://yoursite.com/img/Pacemaker+mfs/Screenshot from 2016-03-11 15:26:16.png">
<meta property="og:image" content="http://yoursite.com/img/Pacemaker+mfs/Screenshot from 2016-03-11 15:38:13.png">
<meta property="og:image" content="http://yoursite.com/img/Pacemaker+mfs/Screenshot from 2016-03-11 16:36:11.png">
<meta property="og:image" content="http://yoursite.com/img/Pacemaker+mfs/Screenshot from 2016-03-11 16:36:49.png">
<meta property="og:image" content="http://yoursite.com/img/Pacemaker+mfs/Screenshot from 2016-03-11 17:43:40.png">
<meta property="og:image" content="http://yoursite.com/img/Pacemaker+mfs/Screenshot from 2016-03-11 17:53:57.png">
<meta property="og:image" content="http://yoursite.com/img/Pacemaker+mfs/Screenshot from 2016-03-11 18:52:53.png">
<meta property="og:image" content="http://yoursite.com/img/Pacemaker+mfs/Screenshot from 2016-03-11 18:54:04.png">
<meta property="og:image" content="http://yoursite.com/img/Pacemaker+mfs/Screenshot from 2016-03-11 18:57:16.png">
<meta property="og:updated_time" content="2016-03-16T02:18:32.566Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Pacemaker+Corosync+MFS">
<meta name="twitter:description" content="Red Hat Enterprise Linux 6.5Pacemaker+MFS解决master的单点故障实验环境1Environment : selinux and iptables disabled&amp;#10;iscsi server : server33.example.com : 172.25.0.33&amp;#10;Master1+Pacemaker : server28.example.co">
  
    <link rel="alternative" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
      <link rel="stylesheet" href="//cdn.bootcss.com/animate.css/3.5.0/animate.min.css" type="text/css">
  
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  <link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  
  
      <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  
  <script>
      var yiliaConfig = {
          fancybox: true,
          animate: true,
          isHome: false,
          isPost: true,
          isArchive: false,
          isTag: false,
          isCategory: false,
          open_in_new: false
      }
  </script>
</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            
            <img lazy-src="/img/GreenArrow.png" class="js-avatar">
            
        </a>

        <hgroup>
          <h1 class="header-author"><a href="/">Wang Chi</a></h1>
        </hgroup>

        
                


        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                        <div class="icon-wrap icon-me hide" data-idx="3">
                            <div class="user"></div>
                            <div class="shoulder"></div>
                        </div>
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        <li>友情链接</li>
                        
                        
                        <li>关于我</li>
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/">主页</a></li>
                        
                            <li><a href="/archives/">所有文章</a></li>
                        
                            <li><a href="/tags/">标签云</a></li>
                        
                            <li><a href="/about/">关于我</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <li id="Email"><a class="Email" target="_blank" href="mailto:123@123.com" title="Email"></a></li>
                            
                                <li id="GitHub"><a class="GitHub" target="_blank" href="/#" title="GitHub"></a></li>
                            
                                <li id="RSS"><a class="RSS" target="_blank" href="/atom.xml" title="RSS"></a></li>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <a href="/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/tags/linux-daily-fault/" style="font-size: 10px;">linux daily fault</a> <a href="/tags/linux-基础/" style="font-size: 15px;">linux 基础</a> <a href="/tags/linux-集群架构篇/" style="font-size: 20px;">linux 集群架构篇</a> <a href="/tags/主页/" style="font-size: 10px;">主页</a>
                    </div>
                </section>
                
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="https://hexo.io">Hexo</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="https://pages.github.com/">GitHub</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="http://moxfive.xyz/">MOxFIVE</a>
                    
                    </div>
                </section>
                

                
                
                <section class="switch-part switch-part4">
                
                    <div id="js-aboutme">专注于前端</div>
                </section>
                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">Wang Chi</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                
                    <img lazy-src="/img/GreenArrow.png" class="js-avatar">
                
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页">Wang Chi</a></h1>
            </hgroup>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/">主页</a></li>
                
                    <li><a href="/archives/">所有文章</a></li>
                
                    <li><a href="/tags/">标签云</a></li>
                
                    <li><a href="/about/">关于我</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                        <ul class="social">
                            
                                <li id="Email"><a class="Email" target="_blank" href="mailto:123@123.com" title="Email"></a></li>
                            
                                <li id="GitHub"><a class="GitHub" target="_blank" href="/#" title="GitHub"></a></li>
                            
                                <li id="RSS"><a class="RSS" target="_blank" href="/atom.xml" title="RSS"></a></li>
                            
                        </ul>
            </nav>
        </header>                
    </div>
</nav>
      <div class="body-wrap"><article id="post-Pacemaker-MFS" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/03/10/Pacemaker-MFS/" class="article-date">
      <time datetime="2016-03-10T13:52:20.000Z" itemprop="datePublished">2016-03-10</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Pacemaker+Corosync+MFS
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/linux-集群架构篇/">linux 集群架构篇</a>
    </div>


        
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux-集群架构篇/">linux 集群架构篇</a></li></ul>
    </div>

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h2 id="Red_Hat_Enterprise_Linux_6-5"><a href="#Red_Hat_Enterprise_Linux_6-5" class="headerlink" title="Red Hat Enterprise Linux 6.5"></a>Red Hat Enterprise Linux 6.5</h2><h2 id="Pacemaker+MFS_u89E3_u51B3master_u7684_u5355_u70B9_u6545_u969C"><a href="#Pacemaker+MFS_u89E3_u51B3master_u7684_u5355_u70B9_u6545_u969C" class="headerlink" title="Pacemaker+MFS解决master的单点故障"></a>Pacemaker+MFS解决master的单点故障</h2><h3 id="u5B9E_u9A8C_u73AF_u5883"><a href="#u5B9E_u9A8C_u73AF_u5883" class="headerlink" title="实验环境"></a>实验环境</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Environment : selinux and iptables disabled&#10;iscsi server : server33.example.com : 172.25.0.33&#10;Master1+Pacemaker : server28.example.com : 172.25.0.28&#10;Master2+Pacemaker : server32.example.com : 172.25.0.32&#10;chunkserver1 : server29.example.com : 172.25.0.29&#10;chunkserver2 : server30.example.com : 172.25.0.30&#10;client : server31.example.com : 172.25.0.31&#10;Master1&#19982;Master2&#38656;&#35201;&#37197;&#32622;yum,&#20351;&#20043;&#28155;&#21152;&#19978;HighAvailability&#31561;&#27169;&#22359;</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<p><code>yum配置</code><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># repos on instructor for classroom use</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Main rh6.5 server</span></span><br><span class="line">[base]</span><br><span class="line">name=Instructor Server Repository</span><br><span class="line">baseurl=http://<span class="number">172.25</span>.<span class="number">0.250</span>/rh6.<span class="number">5</span></span><br><span class="line">gpgcheck=<span class="number">1</span></span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release</span><br><span class="line"></span><br><span class="line"><span class="comment"># HighAvailability rh6.5</span></span><br><span class="line">[HighAvailability]</span><br><span class="line">name=Instructor HighAvailability Repository</span><br><span class="line">baseurl=http://<span class="number">172.25</span>.<span class="number">0.250</span>/rh6.<span class="number">5</span>/HighAvailability</span><br><span class="line">gpgcheck=<span class="number">1</span></span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release</span><br><span class="line"></span><br><span class="line"><span class="comment"># LoadBalancer packages</span></span><br><span class="line">[LoadBalancer]</span><br><span class="line">name=Instructor LoadBalancer Repository</span><br><span class="line">baseurl=http://<span class="number">172.25</span>.<span class="number">0.250</span>/rh6.<span class="number">5</span>/LoadBalancer</span><br><span class="line">gpgcheck=<span class="number">1</span></span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release</span><br><span class="line"></span><br><span class="line"><span class="comment"># ResilientStorage</span></span><br><span class="line">[ResilientStorage]</span><br><span class="line">name=Instructor ResilientStorage Repository</span><br><span class="line">baseurl=http://<span class="number">172.25</span>.<span class="number">0.250</span>/rh6.<span class="number">5</span>/ResilientStorage</span><br><span class="line">gpgcheck=<span class="number">1</span></span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release</span><br><span class="line"></span><br><span class="line"><span class="comment"># ScalableFileSystem</span></span><br><span class="line">[ScalableFileSystem]</span><br><span class="line">name=Instructor ScalableFileSystem Repository</span><br><span class="line">baseurl=http://<span class="number">172.25</span>.<span class="number">0.250</span>/rh6.<span class="number">5</span>/ScalableFileSystem</span><br><span class="line">gpgcheck=<span class="number">1</span></span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release</span><br></pre></td></tr></table></figure></p>
<p><code>iscsi server通过共享存储块给Master1与Master2,Master1与Master2将共享存储块挂载到/var/lib/mfs目录上(只能挂一个),然后将挂载设置，VIP，Fence都交给Pacemaker来管理，这样就实现了高可用。</code><br><strong>注意：</strong><br><code>本实验是基于MooseFs的，所以默认是已经配置好的，如有需要，请查看MooseFs内容</code></p>
<h3 id="iscsi_server_3Aserver33"><a href="#iscsi_server_3Aserver33" class="headerlink" title="iscsi server:server33"></a>iscsi server:server33</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@server33 ~]<span class="comment"># yum install -y scsi-target-utils.x86_64</span></span><br></pre></td></tr></table></figure>
<p><img src="/img/Pacemaker+mfs/Screenshot from 2016-03-11 15:26:16.png" alt="" title="Title"><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line">[root@server33 ~]<span class="comment"># fdisk -cu /dev/vdb</span></span><br><span class="line">Device contains neither a valid DOS partition table, nor Sun, SGI or OSF disklabel</span><br><span class="line">Building a new DOS disklabel with disk identifier <span class="number">0</span>x80d4fcb4.</span><br><span class="line">Changes will remain <span class="keyword">in</span> memory only, until you decide to write them.</span><br><span class="line">After that, of course, the previous content won<span class="string">'t be recoverable.</span><br><span class="line"></span><br><span class="line">Warning: invalid flag 0x0000 of partition table 4 will be corrected by w(rite)</span><br><span class="line"></span><br><span class="line">Command (m for help): n</span><br><span class="line">Command action</span><br><span class="line">   e   extended</span><br><span class="line">   p   primary partition (1-4)</span><br><span class="line">p</span><br><span class="line">Partition number (1-4): 1</span><br><span class="line">First sector (2048-16777215, default 2048):</span><br><span class="line">Using default value 2048</span><br><span class="line">Last sector, +sectors or +size&#123;K,M,G&#125; (2048-16777215, default 16777215):</span><br><span class="line">Using default value 16777215</span><br><span class="line"></span><br><span class="line">Command (m for help): t</span><br><span class="line">Selected partition 1</span><br><span class="line">Hex code (type L to list codes): 8e</span><br><span class="line">Changed system type of partition 1 to 8e (Linux LVM)</span><br><span class="line"></span><br><span class="line">Command (m for help): p</span><br><span class="line"></span><br><span class="line">Disk /dev/vdb: 8589 MB, 8589934592 bytes</span><br><span class="line">16 heads, 63 sectors/track, 16644 cylinders, total 16777216 sectors</span><br><span class="line">Units = sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disk identifier: 0x80d4fcb4</span><br><span class="line"></span><br><span class="line">   Device Boot      Start         End      Blocks   Id  System</span><br><span class="line">/dev/vdb1            2048    16777215     8387584   8e  Linux LVM</span><br><span class="line"></span><br><span class="line">Command (m for help): wq</span><br><span class="line">The partition table has been altered!</span><br><span class="line"></span><br><span class="line">Calling ioctl() to re-read partition table.</span><br><span class="line">Syncing disks.</span><br><span class="line">[root@server33 ~]# pvcreate /dev/vdb1</span><br><span class="line">  Physical volume "/dev/vdb1" successfully created</span><br><span class="line">[root@server33 ~]# vgcreate vg0 /dev/vdb1</span><br><span class="line">  Volume group "vg0" successfully created</span><br><span class="line">[root@server33 ~]# lvcreate -L 6G -n lv0 vg0</span><br><span class="line">  Logical volume "lv0" created</span><br><span class="line">[root@server33 ~]# ll /dev/vg0/lv0</span><br><span class="line">lrwxrwxrwx 1 root root 7 Mar 11 15:36 /dev/vg0/lv0 -&gt; ../dm-2</span><br><span class="line">[root@server33 ~]# vim /etc/tgt/targets.conf</span><br><span class="line">&lt;target iqn.2016-03.com.example:server33.disk&gt;</span><br><span class="line">    backing-store /dev/vg0/lv0</span><br><span class="line">    initiator-address 172.25.0.28</span><br><span class="line">    initiator-address 172.25.0.32</span><br><span class="line">&lt;/target&gt;</span><br><span class="line">[root@server33 ~]# /etc/init.d/tgtd start</span><br><span class="line">Starting SCSI target daemon:                               [  OK  ]</span><br><span class="line">[root@server33 ~]# tgt-admin -s</span><br><span class="line">Target 1: iqn.2016-03.com.example:server33.disk</span><br><span class="line">    System information:</span><br><span class="line">        Driver: iscsi</span><br><span class="line">        State: ready</span><br><span class="line">    I_T nexus information:</span><br><span class="line">    LUN information:</span><br><span class="line">        LUN: 0</span><br><span class="line">            Type: controller</span><br><span class="line">            SCSI ID: IET     00010000</span><br><span class="line">            SCSI SN: beaf10</span><br><span class="line">            Size: 0 MB, Block size: 1</span><br><span class="line">            Online: Yes</span><br><span class="line">            Removable media: No</span><br><span class="line">            Prevent removal: No</span><br><span class="line">            Readonly: No</span><br><span class="line">            Backing store type: null</span><br><span class="line">            Backing store path: None</span><br><span class="line">            Backing store flags:</span><br><span class="line">        LUN: 1</span><br><span class="line">            Type: disk</span><br><span class="line">            SCSI ID: IET     00010001</span><br><span class="line">            SCSI SN: beaf11</span><br><span class="line">            Size: 6442 MB, Block size: 512</span><br><span class="line">            Online: Yes</span><br><span class="line">            Removable media: No</span><br><span class="line">            Prevent removal: No</span><br><span class="line">            Readonly: No</span><br><span class="line">            Backing store type: rdwr</span><br><span class="line">            Backing store path: /dev/vg0/lv0</span><br><span class="line">            Backing store flags:</span><br><span class="line">    Account information:</span><br><span class="line">    ACL information:</span><br><span class="line">        172.25.0.28</span><br><span class="line">        172.25.0.32</span><br><span class="line">[root@server33 ~]# chkconfig tgtd on  ##开机自启</span></span><br></pre></td></tr></table></figure></p>
<p><code>targets.conf</code><br><img src="/img/Pacemaker+mfs/Screenshot from 2016-03-11 15:38:13.png" alt="" title="Title"></p>
<h3 id="Master1+Pacemaker_3Aserver28"><a href="#Master1+Pacemaker_3Aserver28" class="headerlink" title="Master1+Pacemaker:server28"></a>Master1+Pacemaker:server28</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br></pre></td><td class="code"><pre><span class="line">[root@server28 ~]<span class="comment"># cd /mnt/</span></span><br><span class="line">[root@server28 mnt]<span class="comment"># ls</span></span><br><span class="line">mfs  mfs-<span class="number">1.6</span>.<span class="number">27</span>-<span class="number">5</span>.tar.gz  mfs-<span class="number">1.6</span>.<span class="number">27</span>.tar.gz</span><br><span class="line">[root@server28 mnt]<span class="comment"># cat mfs  ##编写的mfs启动脚本</span></span><br><span class="line"><span class="shebang">#!/bin/bash</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Init file for the MooseFS master service</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># chkconfig: - 92 84</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># description: MooseFS master</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># processname: mfsmaster</span></span><br><span class="line"><span class="comment"># Source function library.</span></span><br><span class="line"><span class="comment"># Source networking configuration.</span></span><br><span class="line">. /etc/init.d/<span class="built_in">functions</span></span><br><span class="line">. /etc/sysconfig/network</span><br><span class="line"><span class="comment"># Source initialization configuration.</span></span><br><span class="line"><span class="comment"># Check that networking is up.</span></span><br><span class="line">[ <span class="string">"<span class="variable">$&#123;NETWORKING&#125;</span>"</span> == <span class="string">"no"</span> ] &amp;&amp; <span class="built_in">exit</span> <span class="number">0</span></span><br><span class="line">[ -x <span class="string">"/usr/sbin/mfsmaster"</span> ] || <span class="built_in">exit</span> <span class="number">1</span></span><br><span class="line">[ -r <span class="string">"/etc/mfs/mfsmaster.cfg"</span> ] || <span class="built_in">exit</span> <span class="number">1</span></span><br><span class="line">[ -r <span class="string">"/etc/mfs/mfsexports.cfg"</span> ] || <span class="built_in">exit</span> <span class="number">1</span></span><br><span class="line">RETVAL=<span class="number">0</span></span><br><span class="line">prog=<span class="string">"mfsmaster"</span></span><br><span class="line">datadir=<span class="string">"/var/lib/mfs"</span></span><br><span class="line">mfsbin=<span class="string">"/usr/sbin/mfsmaster"</span></span><br><span class="line">mfsrestore=<span class="string">"/usr/sbin/mfsmetarestore"</span></span><br><span class="line"><span class="function"><span class="title">start</span></span> () &#123;</span><br><span class="line"><span class="built_in">echo</span> -n $<span class="string">"Starting <span class="variable">$prog</span>: "</span></span><br><span class="line"><span class="variable">$mfsbin</span> start &gt;/dev/null <span class="number">2</span>&gt;&amp;<span class="number">1</span> &amp;&amp; success || failure</span><br><span class="line"><span class="keyword">if</span> [ $? <span class="operator">-ne</span> <span class="number">0</span> ];<span class="keyword">then</span></span><br><span class="line"><span class="variable">$mfsrestore</span> <span class="operator">-a</span> &gt;/dev/null <span class="number">2</span>&gt;&amp;<span class="number">1</span> &amp;&amp; <span class="variable">$mfsbin</span> start &gt;/dev/null <span class="number">2</span>&gt;&amp;<span class="number">1</span> &amp;&amp; success || failure</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">RETVAL=$?</span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">return</span> <span class="variable">$RETVAL</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">stop</span></span> () &#123;</span><br><span class="line"><span class="built_in">echo</span> -n $<span class="string">"Stopping <span class="variable">$prog</span>: "</span></span><br><span class="line"><span class="variable">$mfsbin</span> <span class="operator">-s</span> &gt;/dev/null <span class="number">2</span>&gt;&amp;<span class="number">1</span> || killall -<span class="number">9</span> <span class="variable">$prog</span> &gt;/dev/null <span class="number">2</span>&gt;&amp;<span class="number">1</span> &amp;&amp; success || failure</span><br><span class="line">RETVAL=$?</span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">return</span> <span class="variable">$RETVAL</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">restart</span></span> () &#123;</span><br><span class="line">stop</span><br><span class="line">start</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">reload</span></span> () &#123;</span><br><span class="line"><span class="built_in">echo</span> -n $<span class="string">"reload <span class="variable">$prog</span>: "</span></span><br><span class="line"><span class="variable">$mfsbin</span> reload &gt;/dev/null <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">RETVAL=$?</span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">return</span> <span class="variable">$RETVAL</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">restore</span></span> () &#123;</span><br><span class="line"><span class="built_in">echo</span> -n $<span class="string">"restore <span class="variable">$prog</span>: "</span></span><br><span class="line"><span class="variable">$mfsrestore</span> <span class="operator">-a</span> &gt;/dev/null <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">RETVAL=$?</span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">return</span> <span class="variable">$RETVAL</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">case</span> <span class="string">"<span class="variable">$1</span>"</span> <span class="keyword">in</span></span><br><span class="line">start)</span><br><span class="line">start</span><br><span class="line">;;</span><br><span class="line">stop)</span><br><span class="line">stop</span><br><span class="line">;;</span><br><span class="line">restart)</span><br><span class="line">restart</span><br><span class="line">;;</span><br><span class="line">reload)</span><br><span class="line">reload</span><br><span class="line">;;</span><br><span class="line">restore)</span><br><span class="line">restore</span><br><span class="line">;;</span><br><span class="line">status)</span><br><span class="line">status <span class="variable">$prog</span></span><br><span class="line">RETVAL=$?;;</span><br><span class="line">*)</span><br><span class="line"><span class="built_in">echo</span> $<span class="string">"Usage: <span class="variable">$0</span> &#123;start|stop|restart|reload|restore|status&#125;"</span></span><br><span class="line">RETVAL=<span class="number">1</span></span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"><span class="built_in">exit</span> <span class="variable">$RETVAL</span></span><br><span class="line">[root@server28 mnt]<span class="comment"># mv mfs /etc/init.d/  ##将脚本作为mfs的启动脚本</span></span><br><span class="line">[root@server28 mnt]<span class="comment"># chmod +x /etc/init.d/mfs ##给脚本执行权限</span></span><br><span class="line">[root@server28 mnt]<span class="comment"># /etc/init.d/mfs start  ##测试脚本是否正确</span></span><br><span class="line">Starting mfsmaster:                                        [  OK  ]</span><br><span class="line">[root@server28 mnt]<span class="comment"># /etc/init.d/mfs stop</span></span><br><span class="line">Stopping mfsmaster:                                        [  OK  ]</span><br><span class="line">[root@server28 mnt]<span class="comment"># yum install iscsi-initiator-utils.x86_64 -y</span></span><br><span class="line">[root@server28 mnt]<span class="comment"># iscsiadm -m discovery -t st -p 172.25.0.33</span></span><br><span class="line">Starting iscsid:                                           [  OK  ]</span><br><span class="line"><span class="number">172.25</span>.<span class="number">0.33</span>:<span class="number">3260</span>,<span class="number">1</span> iqn.<span class="number">2016</span>-<span class="number">03</span>.com.example:server33.disk</span><br><span class="line">[root@server28 mnt]<span class="comment"># iscsiadm -m node -l</span></span><br><span class="line">Logging <span class="keyword">in</span> to [iface: default, target: iqn.<span class="number">2016</span>-<span class="number">03</span>.com.example:server33.disk, portal: <span class="number">172.25</span>.<span class="number">0.33</span>,<span class="number">3260</span>] (multiple)</span><br><span class="line">Login to [iface: default, target: iqn.<span class="number">2016</span>-<span class="number">03</span>.com.example:server33.disk, portal: <span class="number">172.25</span>.<span class="number">0.33</span>,<span class="number">3260</span>] successful.</span><br><span class="line">[root@server28 mnt]<span class="comment"># fdisk -cu /dev/sda</span></span><br><span class="line">Device contains neither a valid DOS partition table, nor Sun, SGI or OSF disklabel</span><br><span class="line">Building a new DOS disklabel with disk identifier <span class="number">0</span>x02603798.</span><br><span class="line">Changes will remain <span class="keyword">in</span> memory only, until you decide to write them.</span><br><span class="line">After that, of course, the previous content won<span class="string">'t be recoverable.</span><br><span class="line"></span><br><span class="line">Warning: invalid flag 0x0000 of partition table 4 will be corrected by w(rite)</span><br><span class="line"></span><br><span class="line">Command (m for help): n</span><br><span class="line">Command action</span><br><span class="line">   e   extended</span><br><span class="line">   p   primary partition (1-4)</span><br><span class="line">p</span><br><span class="line">Partition number (1-4): 1</span><br><span class="line">First sector (2048-12582911, default 2048):</span><br><span class="line">Using default value 2048</span><br><span class="line">Last sector, +sectors or +size&#123;K,M,G&#125; (2048-12582911, default 12582911):</span><br><span class="line">Using default value 12582911</span><br><span class="line"></span><br><span class="line">Command (m for help): wq</span><br><span class="line">The partition table has been altered!</span><br><span class="line"></span><br><span class="line">Calling ioctl() to re-read partition table.</span><br><span class="line">Syncing disks.</span><br><span class="line">[root@server28 mnt]# mkfs.ext4 /dev/sda1</span><br><span class="line">mke2fs 1.41.12 (17-May-2010)</span><br><span class="line">Filesystem label=</span><br><span class="line">OS type: Linux</span><br><span class="line">Block size=4096 (log=2)</span><br><span class="line">Fragment size=4096 (log=2)</span><br><span class="line">Stride=0 blocks, Stripe width=0 blocks</span><br><span class="line">393216 inodes, 1572608 blocks</span><br><span class="line">78630 blocks (5.00%) reserved for the super user</span><br><span class="line">First data block=0</span><br><span class="line">Maximum filesystem blocks=1610612736</span><br><span class="line">48 block groups</span><br><span class="line">32768 blocks per group, 32768 fragments per group</span><br><span class="line">8192 inodes per group</span><br><span class="line">Superblock backups stored on blocks:</span><br><span class="line">	32768, 98304, 163840, 229376, 294912, 819200, 884736</span><br><span class="line"></span><br><span class="line">Writing inode tables: done                            </span><br><span class="line">Creating journal (32768 blocks): done</span><br><span class="line">Writing superblocks and filesystem accounting information: done</span><br><span class="line"></span><br><span class="line">This filesystem will be automatically checked every 34 mounts or</span><br><span class="line">180 days, whichever comes first.  Use tune2fs -c or -i to override.</span><br><span class="line">[root@server28 mnt]# /etc/init.d/mfs status</span><br><span class="line">mfsmaster is stopped</span><br><span class="line">[root@server28 mnt]# mount /dev/sda1 /mnt  ##挂载之前要保证master服务已关闭</span><br><span class="line">[root@server28 mnt]# cd /var/lib/mfs/</span><br><span class="line">[root@server28 mfs]# ls</span><br><span class="line">changelog.3.mfs  changelog.6.mfs  metadata.mfs.back.1  sessions.mfs</span><br><span class="line">changelog.5.mfs  metadata.mfs     metadata.mfs.empty   stats.mfs</span><br><span class="line">[root@server28 mfs]# cp -p * /mnt/  ##把元数据文件存入共享块中</span><br><span class="line">[root@server28 mfs]# umount /mnt/</span><br><span class="line">[root@server28 mfs]# mount /dev/sda1 /var/lib/mfs/  ##挂载已有元数据文件的共享块到默认元数据存储目录</span><br><span class="line">[root@server28 mfs]# cd</span><br><span class="line"> [root@server28 ~]# ll -d /var/lib/mfs/</span><br><span class="line">drwxr-xr-x 2 root root 4096 Mar 11 16:03 /var/lib/mfs/</span><br><span class="line">[root@server28 ~]# chown nobody /var/lib/mfs/  ##修改权限</span><br><span class="line">[root@server28 ~]# ls /var/lib/mfs/</span><br><span class="line">changelog.3.mfs  changelog.6.mfs  metadata.mfs.back.1  sessions.mfs</span><br><span class="line">changelog.5.mfs  metadata.mfs     metadata.mfs.empty   stats.mfs</span><br><span class="line">[root@server28 ~]# umount /var/lib/mfs/  ##卸载共享块，因为要在Master2上进行测试</span><br><span class="line">[root@server28 ~]# cd rpmbuild/RPMS/x86_64/</span><br><span class="line">[root@server28 x86_64]# ls</span><br><span class="line">mfs-cgi-1.6.27-4.x86_64.rpm          mfs-client-1.6.27-4.x86_64.rpm</span><br><span class="line">mfs-cgiserv-1.6.27-4.x86_64.rpm      mfs-master-1.6.27-4.x86_64.rpm</span><br><span class="line">mfs-chunkserver-1.6.27-4.x86_64.rpm  mfs-metalogger-1.6.27-4.x86_64.rpm</span><br><span class="line">[root@server28 x86_64]# scp mfs-master-1.6.27-4.x86_64.rpm mfs-cgi-1.6.27-4.x86_64.rpm mfs-cgiserv-1.6.27-4.x86_64.rpm root@172.25.0.32:/mnt</span></span><br></pre></td></tr></table></figure>
<h3 id="Master2+Pacemaker_3Aserver32"><a href="#Master2+Pacemaker_3Aserver32" class="headerlink" title="Master2+Pacemaker:server32"></a>Master2+Pacemaker:server32</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@server32 ~]<span class="comment"># cd /mnt/</span></span><br><span class="line">[root@server32 mnt]<span class="comment"># ls</span></span><br><span class="line">mfs-cgi-<span class="number">1.6</span>.<span class="number">27</span>-<span class="number">4</span>.x86_64.rpm      mfs-master-<span class="number">1.6</span>.<span class="number">27</span>-<span class="number">4</span>.x86_64.rpm</span><br><span class="line">mfs-cgiserv-<span class="number">1.6</span>.<span class="number">27</span>-<span class="number">4</span>.x86_64.rpm</span><br><span class="line">[root@server32 mnt]<span class="comment"># rpm -ivh *  ##Master2保持与Master1相同</span></span><br><span class="line">Preparing...                <span class="comment">########################################### [100%]</span></span><br><span class="line">   <span class="number">1</span>:mfs-cgi                <span class="comment">########################################### [ 33%]</span></span><br><span class="line">   <span class="number">2</span>:mfs-cgiserv            <span class="comment">########################################### [ 67%]</span></span><br><span class="line">   <span class="number">3</span>:mfs-master             <span class="comment">########################################### [100%]</span></span><br></pre></td></tr></table></figure>
<h3 id="Master1+Pacemaker_3Aserver28-1"><a href="#Master1+Pacemaker_3Aserver28-1" class="headerlink" title="Master1+Pacemaker:server28"></a>Master1+Pacemaker:server28</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@server28 x86_64]<span class="comment"># cd /etc/mfs/</span></span><br><span class="line">[root@server28 mfs]<span class="comment"># ls</span></span><br><span class="line">mfsexports.cfg       mfsmaster.cfg       mfstopology.cfg</span><br><span class="line">mfsexports.cfg.dist  mfsmaster.cfg.dist  mfstopology.cfg.dist</span><br><span class="line">[root@server28 mfs]<span class="comment"># scp *.cfg root@172.25.0.32:/etc/mfs/  ##直接把主配置文件考到Master2上</span></span><br><span class="line">[root@server28 mfs]<span class="comment"># scp /usr/share/mfscgi/* root@172.25.0.32:/usr/share/mfscgi/  ##把监控数据也考过去</span></span><br><span class="line">[root@server28 mfs]<span class="comment"># scp /etc/init.d/mfs root@172.25.0.32:/etc/init.d/  ##启动脚本也考过去</span></span><br></pre></td></tr></table></figure>
<h3 id="Master2+Pacemaker_3Aserver32-1"><a href="#Master2+Pacemaker_3Aserver32-1" class="headerlink" title="Master2+Pacemaker:server32"></a>Master2+Pacemaker:server32</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@server32 mnt]<span class="comment"># ll /usr/share/mfscgi/*.cgi</span></span><br><span class="line">-rw-r--r-- <span class="number">1</span> root root   <span class="number">1881</span> Mar <span class="number">11</span> <span class="number">16</span>:<span class="number">18</span> /usr/share/mfscgi/chart.cgi</span><br><span class="line">-rw-r--r-- <span class="number">1</span> root root <span class="number">107456</span> Mar <span class="number">11</span> <span class="number">16</span>:<span class="number">18</span> /usr/share/mfscgi/mfs.cgi</span><br><span class="line">[root@server32 mnt]<span class="comment"># chmod +x /usr/share/mfscgi/*.cgi  ##*.cgi文件需要有执行权限</span></span><br><span class="line">[root@server32 mnt]<span class="comment"># ll /etc/init.d/mfs  ##有执行权限，ok</span></span><br><span class="line">-rwxr-xr-x <span class="number">1</span> root root <span class="number">1442</span> Mar <span class="number">11</span> <span class="number">16</span>:<span class="number">19</span> /etc/init.d/mfs</span><br><span class="line">[root@server32 mnt]<span class="comment"># yum install iscsi-initiator-utils.x86_64 -y</span></span><br><span class="line">[root@server32 mnt]<span class="comment"># iscsiadm -m discovery -t st -p 172.25.0.33</span></span><br><span class="line">Starting iscsid:                                           [  OK  ]</span><br><span class="line"><span class="number">172.25</span>.<span class="number">0.33</span>:<span class="number">3260</span>,<span class="number">1</span> iqn.<span class="number">2016</span>-<span class="number">03</span>.com.example:server33.disk</span><br><span class="line">[root@server32 mnt]<span class="comment"># iscsiadm -m node -l</span></span><br><span class="line">Logging <span class="keyword">in</span> to [iface: default, target: iqn.<span class="number">2016</span>-<span class="number">03</span>.com.example:server33.disk, portal: <span class="number">172.25</span>.<span class="number">0.33</span>,<span class="number">3260</span>] (multiple)</span><br><span class="line">Login to [iface: default, target: iqn.<span class="number">2016</span>-<span class="number">03</span>.com.example:server33.disk, portal: <span class="number">172.25</span>.<span class="number">0.33</span>,<span class="number">3260</span>] successful.</span><br><span class="line">[root@server32 mnt]<span class="comment"># mount /dev/sda1 /var/lib/mfs/</span></span><br><span class="line">[root@server32 mnt]<span class="comment"># ll -d /var/lib/mfs/</span></span><br><span class="line">drwxr-xr-x <span class="number">2</span> nobody root <span class="number">4096</span> Mar <span class="number">11</span> <span class="number">16</span>:<span class="number">03</span> /var/lib/mfs/</span><br><span class="line">[root@server32 mnt]<span class="comment"># /etc/init.d/mfs start  ##启动成功，说明配置ok</span></span><br><span class="line">Starting mfsmaster:                                        [  OK  ]</span><br><span class="line">[root@server32 mnt]<span class="comment"># /etc/init.d/mfs stop</span></span><br><span class="line">Stopping mfsmaster:                                        [  OK  ]</span><br><span class="line">[root@server32 mnt]<span class="comment"># umount /var/lib/mfs/  ##卸载共享块，接下来都要交给pacemaker进行管理</span></span><br></pre></td></tr></table></figure>
<h3 id="Master1+Pacemaker_3Aserver28-2"><a href="#Master1+Pacemaker_3Aserver28-2" class="headerlink" title="Master1+Pacemaker:server28"></a>Master1+Pacemaker:server28</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@server28 mfs]<span class="comment"># yum install -y pacemaker</span></span><br><span class="line">[root@server28 mfs]<span class="comment"># cd /mnt/</span></span><br><span class="line">[root@server28 mnt]<span class="comment"># ls</span></span><br><span class="line">crmsh-<span class="number">1.2</span>.<span class="number">6</span>-<span class="number">0</span>.rc2.<span class="number">2.1</span>.x86_64.rpm  mfs-<span class="number">1.6</span>.<span class="number">27</span>-<span class="number">5</span>.tar.gz  pssh-<span class="number">2.3</span>.<span class="number">1</span>-<span class="number">2.1</span>.x86_64.rpm</span><br><span class="line">drbd-<span class="number">8.4</span>.<span class="number">2</span>.tar.gz                 mfs-<span class="number">1.6</span>.<span class="number">27</span>.tar.gz</span><br><span class="line">[root@server28 mnt]<span class="comment"># yum install -y crmsh-1.2.6-0.rc2.2.1.x86_64.rpm pssh-2.3.1-2.1.x86_64.rpm</span></span><br><span class="line">[root@server28 mnt]<span class="comment"># cd /etc/corosync/</span></span><br><span class="line">[root@server28 corosync]<span class="comment"># ls</span></span><br><span class="line">corosync.conf.example  corosync.conf.example.udpu  service.d  uidgid.d</span><br><span class="line">[root@server28 corosync]<span class="comment"># cp corosync.conf.example corosync.conf</span></span><br><span class="line">[root@server28 corosync]<span class="comment"># vim corosync.conf</span></span><br><span class="line">bindnetaddr: <span class="number">172.25</span>.<span class="number">0.0</span>  <span class="comment">##填写网段</span></span><br><span class="line">service &#123;</span><br><span class="line">        ver: <span class="number">0</span>  <span class="comment">##0表示在启动corosync时会自动开启pacemaker</span></span><br><span class="line">        name: pacemaker</span><br><span class="line">&#125;</span><br><span class="line">[root@server28 corosync]<span class="comment"># cd /mnt/</span></span><br><span class="line">[root@server28 mnt]<span class="comment"># scp crmsh-1.2.6-0.rc2.2.1.x86_64.rpm pssh-2.3.1-2.1.x86_64.rpm drbd-8.4.2.tar.gz root@172.25.0.32:/mnt</span></span><br><span class="line">[root@server28 mnt]<span class="comment"># scp /etc/yum.repos.d/dvd.repo root@172.25.0.32:/etc/yum.repos.d/</span></span><br><span class="line">[root@server28 mnt]<span class="comment"># /etc/init.d/corosync start</span></span><br><span class="line">Starting Corosync Cluster Engine (corosync):               [  OK  ]</span><br></pre></td></tr></table></figure>
<p><code>corosync.conf</code><br><img src="/img/Pacemaker+mfs/Screenshot from 2016-03-11 16:36:11.png" alt="" title="Title"><br><img src="/img/Pacemaker+mfs/Screenshot from 2016-03-11 16:36:49.png" alt="" title="Title"></p>
<h3 id="Master2+Pacemaker_3Aserver32-2"><a href="#Master2+Pacemaker_3Aserver32-2" class="headerlink" title="Master2+Pacemaker:server32"></a>Master2+Pacemaker:server32</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@server32 mnt]<span class="comment"># yum install -y pacemaker</span></span><br><span class="line">[root@server32 mnt]<span class="comment"># yum install -y crmsh-1.2.6-0.rc2.2.1.x86_64.rpm pssh-2.3.1-2.1.x86_64.rpm</span></span><br></pre></td></tr></table></figure>
<h3 id="Master1+Pacemaker_3Aserver28-3"><a href="#Master1+Pacemaker_3Aserver28-3" class="headerlink" title="Master1+Pacemaker:server28"></a>Master1+Pacemaker:server28</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@server28 mnt]<span class="comment"># scp /etc/corosync/corosync.conf root@172.25.0.32:/etc/corosync/  ##将已经写好的配置文件拷贝给Master2</span></span><br><span class="line">root@<span class="number">172.25</span>.<span class="number">0.32</span><span class="string">'s password:</span><br><span class="line">corosync.conf                                        100%  482     0.5KB/s   00:00</span></span><br></pre></td></tr></table></figure>
<h3 id="Master2+Pacemaker_3Aserver32-3"><a href="#Master2+Pacemaker_3Aserver32-3" class="headerlink" title="Master2+Pacemaker:server32"></a>Master2+Pacemaker:server32</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@server32 mnt]<span class="comment"># /etc/init.d/corosync start  ##开启成功，表示配置ok</span></span><br><span class="line">Starting Corosync Cluster Engine (corosync):               [  OK  ]</span><br></pre></td></tr></table></figure>
<h3 id="Master1+Pacemaker_3Aserver28-4"><a href="#Master1+Pacemaker_3Aserver28-4" class="headerlink" title="Master1+Pacemaker:server28"></a>Master1+Pacemaker:server28</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">[root@server28 mnt]<span class="comment"># crm_verify -LV  ##检测</span></span><br><span class="line">   error: unpack_resources: 	Resource start-up disabled since no STONITH resources have been defined</span><br><span class="line">   error: unpack_resources: 	Either configure some or <span class="built_in">disable</span> STONITH with the stonith-enabled option</span><br><span class="line">   error: unpack_resources: 	NOTE: Clusters with shared data need STONITH to ensure data integrity</span><br><span class="line">Errors found during check: config not valid</span><br><span class="line">[root@server28 mnt]<span class="comment"># crm</span></span><br><span class="line">crm(live)<span class="comment"># configure</span></span><br><span class="line">crm(live)configure<span class="comment"># property stonith-enabled=false  ##关闭STONITH，关闭这个特性就是告诉集群:假装故障的节点已经安全的关机了。但是，这里要指出,使用STONITH是非常有必</span></span><br><span class="line">要的。</span><br><span class="line">crm(live)configure<span class="comment"># commit  ##提交</span></span><br><span class="line">crm(live)configure<span class="comment"># Ctrl-C, leaving</span></span><br><span class="line">[root@server28 mnt]<span class="comment"># crm_verify -LV  ##没有报错表示ok</span></span><br><span class="line">[root@server28 mnt]<span class="comment"># mkdir /etc/cluster</span></span><br><span class="line">[root@server28 mnt]<span class="comment"># crm  ##进入编辑模式</span></span><br><span class="line">crm(live)<span class="comment"># configure</span></span><br><span class="line">crm(live)configure<span class="comment"># show ##查看</span></span><br><span class="line">node server28.example.com</span><br><span class="line">node server32.example.com</span><br><span class="line">property <span class="variable">$id</span>=<span class="string">"cib-bootstrap-options"</span> \</span><br><span class="line">	dc-version=<span class="string">"1.1.10-14.el6-368c726"</span> \</span><br><span class="line">	cluster-infrastructure=<span class="string">"classic openais (with plugin)"</span> \</span><br><span class="line">	expected-quorum-votes=<span class="string">"2"</span> \</span><br><span class="line">	stonith-enabled=<span class="string">"false"</span></span><br><span class="line">crm(live)configure<span class="comment"># quit</span></span><br><span class="line"><span class="built_in">bye</span></span><br><span class="line">[root@server28 mnt]<span class="comment"># stonith_admin -I  ##查看fence组件是否符合要求</span></span><br><span class="line"> fence_pcmk</span><br><span class="line"> fence_legacy</span><br><span class="line"><span class="number">2</span> devices found</span><br><span class="line">[root@server28 mnt]<span class="comment"># yum install fence-virt -y</span></span><br><span class="line">[root@server28 mnt]<span class="comment"># stonith_admin -I  ##出现以下四个才表示fence配置ok</span></span><br><span class="line"> fence_xvm</span><br><span class="line"> fence_virt</span><br><span class="line"> fence_pcmk</span><br><span class="line"> fence_legacy</span><br><span class="line"><span class="number">4</span> devices found</span><br></pre></td></tr></table></figure>
<h3 id="Master2+Pacemaker_3Aserver32-4"><a href="#Master2+Pacemaker_3Aserver32-4" class="headerlink" title="Master2+Pacemaker:server32"></a>Master2+Pacemaker:server32</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@server32 mnt]<span class="comment"># yum install fence-virt -y</span></span><br><span class="line">[root@server32 mnt]<span class="comment"># stonith_admin -I</span></span><br><span class="line"> fence_xvm</span><br><span class="line"> fence_virt</span><br><span class="line"> fence_pcmk</span><br><span class="line"> fence_legacy</span><br><span class="line"><span class="number">4</span> devices found</span><br><span class="line">[root@server32 mnt]<span class="comment"># mkdir /etc/cluster  ##此目录没有，需要自己建立。</span></span><br></pre></td></tr></table></figure>
<h3 id="u7269_u7406_u673A"><a href="#u7269_u7406_u673A" class="headerlink" title="物理机"></a>物理机</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@foundation ~]<span class="comment"># systemctl status fence_virtd.service  ##fence_virtd服务在之前配置过</span></span><br><span class="line">fence_virtd.service - Fence-Virt system host daemon</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/fence_virtd.service; enabled)</span><br><span class="line">   Active: active (running) since Fri <span class="number">2016</span>-<span class="number">03</span>-<span class="number">11</span> <span class="number">15</span>:<span class="number">06</span>:<span class="number">01</span> CST; <span class="number">2</span>h <span class="number">23</span>min ago</span><br><span class="line">  Process: <span class="number">1565</span> ExecStart=/usr/sbin/fence_virtd <span class="variable">$FENCE_VIRTD_ARGS</span> (code=exited, status=<span class="number">0</span>/SUCCESS)</span><br><span class="line"> Main PID: <span class="number">1577</span> (fence_virtd)</span><br><span class="line">   CGroup: /system.slice/fence_virtd.service</span><br><span class="line">           └─<span class="number">1577</span> /usr/sbin/fence_virtd -w</span><br><span class="line"></span><br><span class="line">Mar <span class="number">11</span> <span class="number">15</span>:<span class="number">06</span>:<span class="number">01</span> foundation.ilt.example.com systemd[<span class="number">1</span>]: Starting Fence-Virt system h....</span><br><span class="line">Mar <span class="number">11</span> <span class="number">15</span>:<span class="number">06</span>:<span class="number">01</span> foundation.ilt.example.com systemd[<span class="number">1</span>]: Started Fence-Virt system ho....</span><br><span class="line">Mar <span class="number">11</span> <span class="number">15</span>:<span class="number">06</span>:<span class="number">01</span> foundation.ilt.example.com fence_virtd[<span class="number">1577</span>]: fence_virtd starting. ...</span><br><span class="line">Hint: Some lines were ellipsized, use <span class="operator">-l</span> to show <span class="keyword">in</span> full.</span><br><span class="line">[root@foundation ~]<span class="comment"># cd /etc/cluster/</span></span><br><span class="line">[root@foundation cluster]<span class="comment"># ls</span></span><br><span class="line">fence_xvm.key</span><br><span class="line">[root@foundation cluster]<span class="comment"># scp fence_xvm.key root@172.25.0.28:/etc/cluster/  ##将key文件传至Master1</span></span><br><span class="line">root@<span class="number">172.25</span>.<span class="number">0.28</span><span class="string">'s password:</span><br><span class="line">fence_xvm.key                                                        100%  128     0.1KB/s   00:00    </span><br><span class="line">[root@foundation cluster]# scp fence_xvm.key root@172.25.0.32:/etc/cluster/  ##将key文件传至Master2</span><br><span class="line">root@172.25.0.32'</span>s password:</span><br><span class="line">fence_xvm.key                                                        <span class="number">100</span>%  <span class="number">128</span>     <span class="number">0.1</span>KB/s   <span class="number">00</span>:<span class="number">00</span></span><br></pre></td></tr></table></figure>
<h3 id="Master1+Pacemaker_3Aserver28-5"><a href="#Master1+Pacemaker_3Aserver28-5" class="headerlink" title="Master1+Pacemaker:server28"></a>Master1+Pacemaker:server28</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@server28 mnt]<span class="comment"># crm</span></span><br><span class="line">crm(live)<span class="comment"># configure</span></span><br><span class="line">crm(live)configure<span class="comment"># primitive xvmfence stonith:fence_xvm params pcmk_host_map="server28.example.com:vm28;server32.example.com:vm32" op monitor interval=60s  ##配置fence策略</span></span><br><span class="line">crm(live)configure<span class="comment"># primitive vip ocf:heartbeat:IPaddr2 params ip=172.25.0.200 cidr_netmask=32 op monitor interval=30s  ##配置VIP</span></span><br><span class="line">crm(live)configure<span class="comment"># commit</span></span><br><span class="line">crm(live)configure<span class="comment"># quit</span></span><br><span class="line"><span class="built_in">bye</span></span><br></pre></td></tr></table></figure>
<p><strong>在server32上执行crm_mon，观察</strong><br><img src="/img/Pacemaker+mfs/Screenshot from 2016-03-11 17:43:40.png" alt="" title="Title"><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">[root@server28 mnt]<span class="comment"># crm</span></span><br><span class="line">crm(live)<span class="comment"># configure</span></span><br><span class="line">crm(live)configure<span class="comment"># property no-quorum-policy=ignore  ##</span></span><br><span class="line">crm(live)configure<span class="comment"># commit</span></span><br><span class="line">crm(live)configure<span class="comment"># cd</span></span><br><span class="line">crm(live)<span class="comment"># status</span></span><br><span class="line">Last updated: Fri Mar <span class="number">11</span> <span class="number">17</span>:<span class="number">46</span>:<span class="number">00</span> <span class="number">2016</span></span><br><span class="line">Last change: Fri Mar <span class="number">11</span> <span class="number">17</span>:<span class="number">45</span>:<span class="number">34</span> <span class="number">2016</span> via cibadmin on server28.example.com</span><br><span class="line">Stack: classic openais (with plugin)</span><br><span class="line">Current DC: server28.example.com - partition with quorum</span><br><span class="line">Version: <span class="number">1.1</span>.<span class="number">10</span>-<span class="number">14</span>.el6-<span class="number">368</span>c726</span><br><span class="line"><span class="number">2</span> Nodes configured, <span class="number">2</span> expected votes</span><br><span class="line"><span class="number">2</span> Resources configured</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Online: [ server28.example.com server32.example.com ]</span><br><span class="line"></span><br><span class="line"> xvmfence	(stonith:fence_xvm):	Started server28.example.com</span><br><span class="line"> vip	(ocf::heartbeat:IPaddr2):	Started server32.example.com</span><br><span class="line">crm(live)<span class="comment"># configure</span></span><br><span class="line">crm(live)configure<span class="comment"># primitive mfsdata ocf:heartbeat:Filesystem params device=/dev/sda1 directory=/var/lib/mfs fstype=ext4 op monitor interval=20s  ##设置mfsdata挂载策略</span></span><br><span class="line">crm(live)configure<span class="comment"># primitive mfsmaster lsb:mfs op monitor interval=20s  ##设置mfs启动脚本</span></span><br><span class="line">crm(live)configure<span class="comment"># group mfsgroup vip mfsdata mfsmaster  ##将vip,mfsdata,mfsmaster加到一个组中</span></span><br><span class="line">crm(live)configure<span class="comment"># show</span></span><br><span class="line">node server28.example.com</span><br><span class="line">node server32.example.com</span><br><span class="line">primitive mfsdata ocf:heartbeat:Filesystem \</span><br><span class="line">	params device=<span class="string">"/dev/sda1"</span> directory=<span class="string">"/var/lib/mfs"</span> fstype=<span class="string">"ext4"</span> \</span><br><span class="line">	op monitor interval=<span class="string">"20s"</span></span><br><span class="line">primitive mfsmaster lsb:mfs \</span><br><span class="line">	op monitor interval=<span class="string">"20s"</span></span><br><span class="line">primitive vip ocf:heartbeat:IPaddr2 \</span><br><span class="line">	params ip=<span class="string">"172.25.0.200"</span> cidr_netmask=<span class="string">"32"</span> \</span><br><span class="line">	op monitor interval=<span class="string">"30s"</span></span><br><span class="line">primitive xvmfence stonith:fence_xvm \</span><br><span class="line">	params pcmk_host_map=<span class="string">"server28.example.com:vm28;server32.example.com:vm32"</span> \</span><br><span class="line">	op monitor interval=<span class="string">"60s"</span></span><br><span class="line">group mfsgroup vip mfsdata mfsmaster</span><br><span class="line">property <span class="variable">$id</span>=<span class="string">"cib-bootstrap-options"</span> \</span><br><span class="line">	dc-version=<span class="string">"1.1.10-14.el6-368c726"</span> \</span><br><span class="line">	cluster-infrastructure=<span class="string">"classic openais (with plugin)"</span> \</span><br><span class="line">	expected-quorum-votes=<span class="string">"2"</span> \</span><br><span class="line">	stonith-enabled=<span class="string">"false"</span> \</span><br><span class="line">	no-quorum-policy=<span class="string">"ignore"</span></span><br><span class="line">crm(live)configure<span class="comment"># commit ##提交，如果警告设置的时间不符合默认要求，则可以忽略。</span></span><br><span class="line">WARNING: mfsdata: default timeout <span class="number">20</span>s <span class="keyword">for</span> start is smaller than the advised <span class="number">60</span></span><br><span class="line">WARNING: mfsdata: default timeout <span class="number">20</span>s <span class="keyword">for</span> stop is smaller than the advised <span class="number">60</span></span><br><span class="line">WARNING: mfsdata: default timeout <span class="number">20</span>s <span class="keyword">for</span> monitor is smaller than the advised <span class="number">40</span></span><br><span class="line">crm(live)configure<span class="comment"># quit</span></span><br><span class="line"><span class="built_in">bye</span></span><br></pre></td></tr></table></figure></p>
<p><strong>在server32上执行crm_mon，观察</strong><br><img src="/img/Pacemaker+mfs/Screenshot from 2016-03-11 17:53:57.png" alt="" title="Title"></p>
<h2 id="u89E3_u6790_u5168_u90E8_u6307_u5411VIP"><a href="#u89E3_u6790_u5168_u90E8_u6307_u5411VIP" class="headerlink" title="解析全部指向VIP"></a>解析全部指向VIP</h2><h3 id="chunkserver1_3Aserver29"><a href="#chunkserver1_3Aserver29" class="headerlink" title="chunkserver1:server29"></a>chunkserver1:server29</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@server29 ~]<span class="comment"># vim /etc/hosts</span></span><br><span class="line"><span class="number">172.25</span>.<span class="number">0.200</span> mfsmaster</span><br></pre></td></tr></table></figure>
<h3 id="chunkserver2_3Aserver30"><a href="#chunkserver2_3Aserver30" class="headerlink" title="chunkserver2:server30"></a>chunkserver2:server30</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@server30 ~]<span class="comment"># vim /etc/hosts</span></span><br><span class="line"><span class="number">172.25</span>.<span class="number">0.200</span> mfsmaster</span><br></pre></td></tr></table></figure>
<h3 id="client_3Aserver31"><a href="#client_3Aserver31" class="headerlink" title="client:server31"></a>client:server31</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@server31 ~]<span class="comment"># vim /etc/hosts</span></span><br><span class="line"><span class="number">172.25</span>.<span class="number">0.200</span> mfsmaster</span><br></pre></td></tr></table></figure>
<h2 id="u6D4B_u8BD5"><a href="#u6D4B_u8BD5" class="headerlink" title="测试"></a>测试</h2><p>注意：<br><code>首先要保证iscsi server的tgtd服务是开启状态，两台master的corosync服务是开启的，两台chunkserver的mfschunkserver服务是开启的，物理机的fence_virtd.service是开启的，然后client再进行mfsmount挂载动作</code></p>
<h3 id="client_3Aserver31-1"><a href="#client_3Aserver31-1" class="headerlink" title="client:server31"></a>client:server31</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@server31 ~]<span class="comment"># mfsmount</span></span><br><span class="line">mfsmaster accepted connection with parameters: <span class="built_in">read</span>-write,restricted_ip ; root mapped to root:root</span><br><span class="line">[root@server31 ~]<span class="comment"># df -h</span></span><br><span class="line">Filesystem                    Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/mapper/VolGroup-lv_root  <span class="number">6.7</span>G  <span class="number">875</span>M  <span class="number">5.5</span>G  <span class="number">14</span>% /</span><br><span class="line">tmpfs                         <span class="number">499</span>M     <span class="number">0</span>  <span class="number">499</span>M   <span class="number">0</span>% /dev/shm</span><br><span class="line">/dev/vda1                     <span class="number">485</span>M   <span class="number">33</span>M  <span class="number">427</span>M   <span class="number">8</span>% /boot</span><br><span class="line">mfsmaster:<span class="number">9421</span>                 <span class="number">11</span>G  <span class="number">201</span>M   <span class="number">11</span>G   <span class="number">2</span>% /mnt/mfs   <span class="comment">##挂载成功</span></span><br><span class="line">[root@server31 ~]<span class="comment"># cd /mnt/mfs</span></span><br><span class="line">[root@server31 mfs]<span class="comment"># ls</span></span><br><span class="line">dir1  dir2</span><br><span class="line">[root@server31 mfs]<span class="comment"># cd dir2/</span></span><br><span class="line">[root@server31 dir2]<span class="comment"># ls</span></span><br><span class="line">bigfile1  shadow</span><br><span class="line">[root@server31 dir2]<span class="comment"># cp /etc/fstab .  ##存储数据成功</span></span><br><span class="line">[root@server31 dir2]<span class="comment"># ls</span></span><br><span class="line">bigfile1  fstab  shadow</span><br></pre></td></tr></table></figure>
<h3 id="Master1+Pacemaker_3Aserver28-6"><a href="#Master1+Pacemaker_3Aserver28-6" class="headerlink" title="Master1+Pacemaker:server28"></a>Master1+Pacemaker:server28</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@server28 mnt]<span class="comment"># /etc/init.d/mfs status</span></span><br><span class="line">mfsmaster is stopped  </span><br><span class="line">[root@server28 mnt]<span class="comment"># crm_mon  ##发现服务组都在Master2上</span></span><br><span class="line">Last updated: Fri Mar <span class="number">11</span> <span class="number">18</span>:<span class="number">21</span>:<span class="number">36</span> <span class="number">2016</span></span><br><span class="line">Last change: Fri Mar <span class="number">11</span> <span class="number">17</span>:<span class="number">53</span>:<span class="number">15</span> <span class="number">2016</span> via cibadmin on server28.example.com</span><br><span class="line">Stack: classic openais (with plugin)</span><br><span class="line">Current DC: server28.example.com - partition with quorum</span><br><span class="line">Version: <span class="number">1.1</span>.<span class="number">10</span>-<span class="number">14</span>.el6-<span class="number">368</span>c726</span><br><span class="line"><span class="number">2</span> Nodes configured, <span class="number">2</span> expected votes</span><br><span class="line"><span class="number">4</span> Resources configured</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Online: [ server28.example.com server32.example.com ]</span><br><span class="line"></span><br><span class="line">xvmfence        (stonith:fence_xvm):    Started server28.example.com</span><br><span class="line"> Resource Group: mfsgroup</span><br><span class="line">     vip        (ocf::heartbeat:IPaddr2):	Started server32.example.com</span><br><span class="line">     mfsdata    (ocf::heartbeat:Filesystem):    Started server32.example.com</span><br><span class="line">     mfsmaster  (lsb:mfs):	Started server32.example.com</span><br></pre></td></tr></table></figure>
<h3 id="Master2+Pacemaker_3Aserver32-5"><a href="#Master2+Pacemaker_3Aserver32-5" class="headerlink" title="Master2+Pacemaker:server32"></a>Master2+Pacemaker:server32</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@server32 ~]<span class="comment"># crm node standby  ##Master2节点进入待命状态</span></span><br></pre></td></tr></table></figure>
<h3 id="Master1+Pacemaker_3Aserver28-7"><a href="#Master1+Pacemaker_3Aserver28-7" class="headerlink" title="Master1+Pacemaker:server28"></a>Master1+Pacemaker:server28</h3><p><code>查看监控crm_mon</code><br><img src="/img/Pacemaker+mfs/Screenshot from 2016-03-11 18:52:53.png" alt="" title="Title"></p>
<h3 id="Master2+Pacemaker_3Aserver32-6"><a href="#Master2+Pacemaker_3Aserver32-6" class="headerlink" title="Master2+Pacemaker:server32"></a>Master2+Pacemaker:server32</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@server32 ~]<span class="comment"># crm node online  ##Master2节点上线</span></span><br></pre></td></tr></table></figure>
<h3 id="Master1+Pacemaker_3Aserver28-8"><a href="#Master1+Pacemaker_3Aserver28-8" class="headerlink" title="Master1+Pacemaker:server28"></a>Master1+Pacemaker:server28</h3><p><code>查看监控crm_mon</code><br><img src="/img/Pacemaker+mfs/Screenshot from 2016-03-11 18:54:04.png" alt="" title="Title"></p>
<h3 id="Pacemaker_u914D_u7F6E_u7B56_u7565_u603B_u89C8"><a href="#Pacemaker_u914D_u7F6E_u7B56_u7565_u603B_u89C8" class="headerlink" title="Pacemaker配置策略总览"></a>Pacemaker配置策略总览</h3><p><img src="/img/Pacemaker+mfs/Screenshot from 2016-03-11 18:57:16.png" alt="" title="Title"><br><code>通过以上方案，就避免了master的单点故障</code></p>
<h2 id="u63A5_u7740_uFF0C_u6211_u4EEC_u7ED3_u5408drbd_uFF0C_u4F1A_u4F7F_u6574_u4E2A_u65B9_u6848_u7684_u53EF_u9760_u6027_u66F4_u9AD8"><a href="#u63A5_u7740_uFF0C_u6211_u4EEC_u7ED3_u5408drbd_uFF0C_u4F1A_u4F7F_u6574_u4E2A_u65B9_u6848_u7684_u53EF_u9760_u6027_u66F4_u9AD8" class="headerlink" title="接着，我们结合drbd，会使整个方案的可靠性更高"></a>接着，我们结合drbd，会使整个方案的可靠性更高</h2><h2 id="Pacemaker+Corosync+drbd+MFS"><a href="#Pacemaker+Corosync+drbd+MFS" class="headerlink" title="Pacemaker+Corosync+drbd+MFS"></a>Pacemaker+Corosync+drbd+MFS</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>
    
  </div>
  
    
    <div class="copyright">
        <p><span>本文标题:</span><a href="/2016/03/10/Pacemaker-MFS/">Pacemaker+Corosync+MFS</a></p>
        <p><span>文章作者:</span><a href="/" title="访问 Wang Chi 的个人博客">Wang Chi</a></p>
        <p><span>发布时间:</span>2016年03月10日 - 21时52分</p>
        <p><span>最后更新:</span>2016年03月16日 - 10时18分</p>
        <p>
            <span>原始链接:</span><a class="post-url" href="/2016/03/10/Pacemaker-MFS/" title="Pacemaker+Corosync+MFS">http://yoursite.com/2016/03/10/Pacemaker-MFS/</a>
            <span class="copy-path" data-clipboard-text="原文: http://yoursite.com/2016/03/10/Pacemaker-MFS/　　作者: Wang Chi" title="点击复制文章链接"><i class="fa fa-clipboard"></i></span>
            <script src="/js/clipboard.min.js"></script>
            <script> var clipboard = new Clipboard('.copy-path'); </script>
        </p>
        <p>
            <span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/cn/" title="中国大陆 (CC BY-NC-SA 3.0 CN)" target = "_blank">"署名-非商用-相同方式共享 3.0"</a> 转载请保留原文链接及作者。
        </p>
    </div>



    <nav id="article-nav">
        
            <div id="article-nav-newer" class="article-nav-title">
                <a href="/2016/04/04/USB-input-output-error/">
                    USB-input,output-error
                </a>
            </div>
        
        
            <div id="article-nav-older" class="article-nav-title">
                <a href="/2016/03/07/MooseFs/">
                    MooseFs
                </a>
            </div>
        
    </nav>

  
</article>

    <div id="toc" class="toc-article">
    <strong class="toc-title">文章目录</strong>
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Red_Hat_Enterprise_Linux_6-5"><span class="toc-number">1.</span> <span class="toc-text">Red Hat Enterprise Linux 6.5</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Pacemaker+MFS_u89E3_u51B3master_u7684_u5355_u70B9_u6545_u969C"><span class="toc-number">2.</span> <span class="toc-text">Pacemaker+MFS解决master的单点故障</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#u5B9E_u9A8C_u73AF_u5883"><span class="toc-number">2.1.</span> <span class="toc-text">实验环境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#iscsi_server_3Aserver33"><span class="toc-number">2.2.</span> <span class="toc-text">iscsi server:server33</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Master1+Pacemaker_3Aserver28"><span class="toc-number">2.3.</span> <span class="toc-text">Master1+Pacemaker:server28</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Master2+Pacemaker_3Aserver32"><span class="toc-number">2.4.</span> <span class="toc-text">Master2+Pacemaker:server32</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Master1+Pacemaker_3Aserver28-1"><span class="toc-number">2.5.</span> <span class="toc-text">Master1+Pacemaker:server28</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Master2+Pacemaker_3Aserver32-1"><span class="toc-number">2.6.</span> <span class="toc-text">Master2+Pacemaker:server32</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Master1+Pacemaker_3Aserver28-2"><span class="toc-number">2.7.</span> <span class="toc-text">Master1+Pacemaker:server28</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Master2+Pacemaker_3Aserver32-2"><span class="toc-number">2.8.</span> <span class="toc-text">Master2+Pacemaker:server32</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Master1+Pacemaker_3Aserver28-3"><span class="toc-number">2.9.</span> <span class="toc-text">Master1+Pacemaker:server28</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Master2+Pacemaker_3Aserver32-3"><span class="toc-number">2.10.</span> <span class="toc-text">Master2+Pacemaker:server32</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Master1+Pacemaker_3Aserver28-4"><span class="toc-number">2.11.</span> <span class="toc-text">Master1+Pacemaker:server28</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Master2+Pacemaker_3Aserver32-4"><span class="toc-number">2.12.</span> <span class="toc-text">Master2+Pacemaker:server32</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#u7269_u7406_u673A"><span class="toc-number">2.13.</span> <span class="toc-text">物理机</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Master1+Pacemaker_3Aserver28-5"><span class="toc-number">2.14.</span> <span class="toc-text">Master1+Pacemaker:server28</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#u89E3_u6790_u5168_u90E8_u6307_u5411VIP"><span class="toc-number">3.</span> <span class="toc-text">解析全部指向VIP</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#chunkserver1_3Aserver29"><span class="toc-number">3.1.</span> <span class="toc-text">chunkserver1:server29</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#chunkserver2_3Aserver30"><span class="toc-number">3.2.</span> <span class="toc-text">chunkserver2:server30</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#client_3Aserver31"><span class="toc-number">3.3.</span> <span class="toc-text">client:server31</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#u6D4B_u8BD5"><span class="toc-number">4.</span> <span class="toc-text">测试</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#client_3Aserver31-1"><span class="toc-number">4.1.</span> <span class="toc-text">client:server31</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Master1+Pacemaker_3Aserver28-6"><span class="toc-number">4.2.</span> <span class="toc-text">Master1+Pacemaker:server28</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Master2+Pacemaker_3Aserver32-5"><span class="toc-number">4.3.</span> <span class="toc-text">Master2+Pacemaker:server32</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Master1+Pacemaker_3Aserver28-7"><span class="toc-number">4.4.</span> <span class="toc-text">Master1+Pacemaker:server28</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Master2+Pacemaker_3Aserver32-6"><span class="toc-number">4.5.</span> <span class="toc-text">Master2+Pacemaker:server32</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Master1+Pacemaker_3Aserver28-8"><span class="toc-number">4.6.</span> <span class="toc-text">Master1+Pacemaker:server28</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Pacemaker_u914D_u7F6E_u7B56_u7565_u603B_u89C8"><span class="toc-number">4.7.</span> <span class="toc-text">Pacemaker配置策略总览</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#u63A5_u7740_uFF0C_u6211_u4EEC_u7ED3_u5408drbd_uFF0C_u4F1A_u4F7F_u6574_u4E2A_u65B9_u6848_u7684_u53EF_u9760_u6027_u66F4_u9AD8"><span class="toc-number">5.</span> <span class="toc-text">接着，我们结合drbd，会使整个方案的可靠性更高</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Pacemaker+Corosync+drbd+MFS"><span class="toc-number">6.</span> <span class="toc-text">Pacemaker+Corosync+drbd+MFS</span></a></li></ol>
</div>
<style>
    .left-col .switch-btn {
        display: none;
    }
    .left-col .switch-area {
        display: none;
    }
</style>

<input type="button" id="tocButton" value="隐藏目录"  title="点击按钮隐藏或者显示文章目录">

<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js" type="text/javascript"></script>
<script>
    var valueHide = "隐藏目录";
    var valueShow = "显示目录";

    if ($(".left-col").is(":hidden")) {
        $("#tocButton").attr("value", valueShow);
    }

    $("#tocButton").click(function() {
        if ($("#toc").is(":hidden")) {
            $("#tocButton").attr("value", valueHide);
            $("#toc").slideDown(320);
            $(".switch-btn, .switch-area").fadeOut(300);
        }
        else {
            $("#tocButton").attr("value", valueShow);
            $("#toc").slideUp(350);
            $(".switch-btn, .switch-area").fadeIn(500);
        }
    })

    if ($(".toc").length < 1) {
        $("#toc, #tocButton").hide();
        $(".switch-btn, .switch-area").show();
    }
</script>




    <div class="share">
    <div class="bdsharebuttonbox">
    <a href="#" class="bds_more" data-cmd="more"></a>
    <a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
    <a href="#" class="bds_sqq" data-cmd="sqq" title="分享给 QQ 好友"></a>
    <a href="#" class="bds_copy" data-cmd="copy" title="复制网址"></a>
    <a href="#" class="bds_mail" data-cmd="mail" title="通过邮件分享"></a>
    <a href="#" class="bds_weixin" data-cmd="weixin" title="生成文章二维码"></a>
    </div>
    <script>
        window._bd_share_config={
            "common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"24"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
    </script>
</div>



    




    <div class="scroll" id="post-nav-button">
        
            <a href="/2016/04/04/USB-input-output-error/" title="上一篇: USB-input,output-error">
                <i class="fa fa-angle-left"></i>
            </a>
        

        <a title="文章列表"><i class="fa fa-bars"></i><i class="fa fa-times"></i></a>

        
            <a href="/2016/03/07/MooseFs/" title="下一篇: MooseFs">
                <i class="fa fa-angle-right"></i>
            </a>
        
    </div>

    <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/05/14/Python入门/">Python入门</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/04/27/Docker/">Docker</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/04/04/USB-input-output-error/">USB-input,output-error</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/10/Pacemaker-MFS/">Pacemaker+Corosync+MFS</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/07/MooseFs/">MooseFs</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/07/Varnish/">Varnish</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/03/HA/">HA高可用集群</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/01/Zabbix/">Zabbix</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/01/Ganglia/">Ganglia</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/29/Nagios-WeiXin/">Nagios-WeiXin</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/24/Nagios-monitoring-platform/">Nagios-monitoring-platform</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/24/Cacti-monitoring-platform/">Cacti-monitoring-platform</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/23/MySQL/">MySQL</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/22/nginx-tomcat-memcached/">nginx+tomcat+memcached</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/22/tomcat-jdk/">tomcat+jdk</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/21/PHP/">PHP</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/20/Nginx/">Nginx</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/19/lanmp-separation/">lanmp-separation</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/18/lanmp/">lanmp</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/17/encapsulate-virtual-machine/">Encapsulate-virtual-machine</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/14/RH124-unit15/">15.Using Virtualized Systems</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/13/RH124-unit14/">14.Accessing Linux File Systems</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/13/RH124-unit13/">13.Installingand Updating Software Packages</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/13/RH124-unit12/">12.Archiving and Copying Files Between Systems</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/09/RH124-unit11/">11.Managing Red Hat Enterprise Linux Networking</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/09/RH124-unit10/">10.Analyzing and Storing Logs</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/09/RH124-unit9/">9.Configuring and Securing OpenSSH Service</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/09/RH124-unit8/">8.Controlling Services and Daemons</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/09/RH124-unit7/">7.Monitoring and Managing Linux Processes</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/09/RH124-unit6/">6.Controlling Access to Files with Linux File System Permissions</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/05/RH124-unit5/">5.Managing Local Linux Users and Groups</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/03/RH124-unit4/">4.Creating, Viewing, and Editing Text Files</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/02/RH124-unit3/">3.Getting Help in Red Hat Enterprise Linux</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/02/RH124-unit2/">2.Managing Files Form The Command Line</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/02/RH124-unit1/">1.Accessing The Command Line</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/01/myfirst/">Wellcome to my blog</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/26/hello-world/">Hello World</a></li></ul>
    <script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
    <script>
        $(".post-list").addClass("toc-article");
        $(".post-list-item a").attr("target","_blank");
        $("#post-nav-button > a:nth-child(2)").click(function() {
            $(".fa-bars, .fa-times").toggle();
            $(".post-list").toggle(300);
            if ($(".toc").length > 0) {
                $("#toc, #tocButton").toggle(200, function() {
                    if ($(".switch-area").is(":visible")) {
                        $("#toc, .switch-btn, .switch-area").toggle();
                        $("#tocButton").attr("value", valueHide);
                        }
                    })
            }
            else {
                $(".switch-btn, .switch-area").fadeToggle(300);
            }
        })
    </script>




    <script>
        
    </script>
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                &copy; 2016 Wang Chi
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank" title="快速、简洁且高效的静态博客框架">Hexo</a>  Theme <a href="https://github.com/MOxFIVE/hexo-theme-yelee" target="_blank" title="简而不减双栏 Hexo 博客主题">Yelee</a> by MOxFIVE
            </div>
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style='display:none'>
                        <span id="site-visit" >本站到访数: 
                            <span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>, </span>
                
                
                    <span id="busuanzi_container_page_pv" style='display:none'>
                        <span id="page-visit">本页阅读量: 
                            <span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        
    </div>
</footer>
    </div>
    
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js" type="text/javascript"></script>
<script src="/js/main.js" type="text/javascript"></script>

    <script>
        $(document).ready(function() {
            var iPad = window.navigator.userAgent.indexOf('iPad');
            if (iPad > -1 || $(".left-col").css("display") === "none") {
                var bgColorList = ["#9db3f4", "#414141", "#e5a859", "#f5dfc6", "#c084a0", "#847e72", "#cd8390", "#996731"];
                var bgColor = Math.ceil(Math.random() * (bgColorList.length - 1));
                $("body").css({"background-color": bgColorList[bgColor], "background-size": "cover"});
            }
            else {
                var backgroundnum = 5;
                var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
                $("body").css({"background": backgroundimg, "background-attachment": "fixed", "background-size": "cover"});
            }
        })
    </script>




<div class="scroll" id="scroll">
    <a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments" title="查看评论"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
</div>

<script>
    $(document).ready(function() {
        if ($("#comments").length < 1) {
            $("#scroll > a:nth-child(2)").hide();
        };
    })
</script>


<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
  </div>
</body>
</html>